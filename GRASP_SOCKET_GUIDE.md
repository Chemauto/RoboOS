# æŠ“å–æ¨¡å— Socket é€šä¿¡æŒ‡å—

## ğŸ“‹ æ–¹æ¡ˆè¯´æ˜

ç”±äºæŠ“å–è„šæœ¬éœ€è¦åœ¨å¼€å‘æ¿ä¸Šæ‰“å¼€æ‘„åƒå¤´æ˜¾ç¤ºç”»é¢ï¼Œä½¿ç”¨SSHæ‰§è¡Œä¼šæœ‰é—®é¢˜ã€‚å› æ­¤æ”¹ç”¨**Socketé€šä¿¡**æ–¹æ¡ˆï¼š

```
ä½ çš„ç”µè„‘ (RoboOS)                    å¼€å‘æ¿
     |                                    |
     |  å‘é€ 0xAA æŒ‡ä»¤                    |
     |----------------------------------->|
     |                                    |  1. æ¥æ”¶ 0xAA
     |                                    |  2. æ‰“å¼€æ‘„åƒå¤´
     |                                    |  3. æ˜¾ç¤ºç”»é¢ï¼ˆåœ¨å¼€å‘æ¿ä¸Šï¼‰
     |                                    |  4. æ‰§è¡ŒæŠ“å–è„šæœ¬
     |                                    |  5. è¿”å›ç»“æœ
     |<-----------------------------------|
     |  æ”¶åˆ°å“åº”                           |
```

**åè®®ç‰¹ç‚¹ï¼š**
- âœ… è¶…ç®€å•ï¼šåªéœ€å‘é€å•å­—èŠ‚ `0xAA`
- âœ… ä¸éœ€è¦å‚æ•°ï¼šä¸åŒºåˆ†é¢œè‰²ï¼Œç»Ÿä¸€å¤„ç†
- âœ… å®¹æ˜“è°ƒè¯•ï¼šåå…­è¿›åˆ¶ä¸€ç›®äº†ç„¶
- âœ… å¿«é€Ÿå“åº”ï¼šæ•°æ®é‡å°ï¼Œè§£æå¿«

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3æ­¥ï¼‰

### æ­¥éª¤1ï¼šå¤åˆ¶æœåŠ¡å™¨ç¨‹åºåˆ°å¼€å‘æ¿

```bash
# å¤åˆ¶æœåŠ¡å™¨ç¨‹åºåˆ°å¼€å‘æ¿
scp grasp_server.py HwHiAiUser@192.168.0.155:/home/HwHiAiUser/

# ä¼šè¦æ±‚è¾“å…¥å¯†ç 
```

### æ­¥éª¤2ï¼šåœ¨å¼€å‘æ¿ä¸Šå¯åŠ¨æœåŠ¡å™¨

```bash
# SSHç™»å½•åˆ°å¼€å‘æ¿
ssh HwHiAiUser@192.168.0.155

# è¿›å…¥ä¸»ç›®å½•
cd ~

# å¯åŠ¨æœåŠ¡å™¨ï¼ˆå‰å°è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—ï¼‰
python3 grasp_server.py
```

ä½ ä¼šçœ‹åˆ°ï¼š
```
============================================================
æŠ“å–æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
ç›‘å¬åœ°å€: 0.0.0.0:9999
æŠ“å–æŒ‡ä»¤: 0xAA
æŠ“å–è„šæœ¬: /home/HwHiAiUser/test.sh
============================================================
ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...
æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨
============================================================
```

### æ­¥éª¤3ï¼šé‡å¯ RoboOS å¹¶æµ‹è¯•

```bash
# åœ¨ä½ çš„ç”µè„‘ä¸Šï¼Œé‡å¯ master å’Œ slaver
# æŒ‰ Ctrl+C åœæ­¢å½“å‰çš„ï¼Œç„¶åï¼š

# ç»ˆç«¯2ï¼šé‡å¯ Master
python master/run.py

# ç»ˆç«¯3ï¼šé‡å¯ Slaver
python slaver/run.py
```

é€šè¿‡ Web UI æˆ–æµ‹è¯•è„šæœ¬å‘é€ï¼š
```
"æ‰§è¡ŒæŠ“å–"
```

---

## ğŸ“¡ é€šä¿¡åè®®

### æŒ‡ä»¤æ ¼å¼

```
0xAA  (å•å­—èŠ‚)
```

**è¯´æ˜ï¼š**
- å‘é€å•ä¸ªå­—èŠ‚ `0xAA`ï¼ˆåå…­è¿›åˆ¶ï¼‰= `170`ï¼ˆåè¿›åˆ¶ï¼‰
- å¼€å‘æ¿æ”¶åˆ°åæ‰§è¡ŒæŠ“å–è„šæœ¬
- ä¸éœ€è¦ä»»ä½•å‚æ•°

### å“åº”æ ¼å¼

```
SUCCESS:00:æŠ“å–æ‰§è¡ŒæˆåŠŸ
FAILED:04:æŠ“å–å¤±è´¥
```

### å“åº”ç 

| å“åº”ç  | è¯´æ˜ |
|--------|------|
| 0x00 | æ‰§è¡ŒæˆåŠŸ |
| 0x01 | æŒ‡ä»¤æ ¼å¼é”™è¯¯ï¼ˆä¸æ˜¯ 0xAAï¼‰ |
| 0x02 | ï¼ˆä¿ç•™ï¼‰ |
| 0x03 | æŠ“å–è„šæœ¬ä¸å­˜åœ¨ |
| 0x04 | æŠ“å–å¤±è´¥ |
| 0x05 | æœªçŸ¥é”™è¯¯ |

---

## ğŸ”§ åå°è¿è¡ŒæœåŠ¡å™¨ï¼ˆæ¨èï¼‰

### æ–¹æ³•1ï¼šä½¿ç”¨ nohup

```bash
# SSHç™»å½•åˆ°å¼€å‘æ¿
ssh HwHiAiUser@192.168.0.155

# åå°è¿è¡ŒæœåŠ¡å™¨
cd ~
nohup python3 grasp_server.py > grasp_server.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f grasp_server.log

# åœæ­¢æœåŠ¡å™¨
ps aux | grep grasp_server
kill <PID>
```

### æ–¹æ³•2ï¼šä½¿ç”¨ systemdï¼ˆæœ€ä½³ï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/grasp-server.service`ï¼š

```ini
[Unit]
Description=Grasp Server for RoboOS
After=network.target

[Service]
Type=simple
User=HwHiAiUser
WorkingDirectory=/home/HwHiAiUser
ExecStart=/usr/bin/python3 /home/HwHiAiUser/grasp_server.py
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
```

å®‰è£…å¹¶å¯åŠ¨æœåŠ¡ï¼š

```bash
# å¤åˆ¶æœåŠ¡æ–‡ä»¶åˆ°å¼€å‘æ¿
scp grasp-server.service HwHiAiUser@192.168.0.155:/tmp/

# SSHç™»å½•åˆ°å¼€å‘æ¿
ssh HwHiAiUser@192.168.0.155

# å®‰è£…æœåŠ¡ï¼ˆéœ€è¦rootæƒé™ï¼‰
sudo mv /tmp/grasp-server.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable grasp-server
sudo systemctl start grasp-server

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status grasp-server

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u grasp-server -f
```

---

## ğŸ§ª æµ‹è¯•è¿æ¥

### æµ‹è¯•1ï¼šæ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬

```bash
# åœ¨ä½ çš„ç”µè„‘ä¸Šæµ‹è¯•
telnet 192.168.0.155 9999

# æˆ–ä½¿ç”¨ nc
nc -zv 192.168.0.155 9999
```

### æµ‹è¯•2ï¼šæ‰‹åŠ¨å‘é€æŒ‡ä»¤

**ä½¿ç”¨ Pythonï¼š**
```python
import socket
sock = socket.socket()
sock.connect(('192.168.0.155', 9999))
sock.send(bytes([0xAA]))  # å‘é€ 0xAA
response = sock.recv(1024)
print(response.decode())
sock.close()
```

**ä½¿ç”¨ echo + ncï¼š**
```bash
# æ³¨æ„ï¼šecho å¯èƒ½ä¸é€‚ç”¨äºå‘é€äºŒè¿›åˆ¶æ•°æ®
# æ¨è Python æµ‹è¯•
```

---

## ğŸ“ å¼€å‘æ¿è„šæœ¬è¦æ±‚

ä½ çš„æŠ“å–è„šæœ¬ (`test.sh`) åªéœ€è¦æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„bashè„šæœ¬ï¼š

```bash
#!/bin/bash

# ä½ çš„æŠ“å–ç¨‹åº
echo "å¯åŠ¨æŠ“å–ç¨‹åº..."

# ç¤ºä¾‹ï¼šè¿è¡Œ Python æŠ“å–è„šæœ¬
python3 your_grasp_program.py

echo "æŠ“å–å®Œæˆ"
```

**é‡è¦æç¤ºï¼š**
- è„šæœ¬å¿…é¡»å¯æ‰§è¡Œï¼š`chmod +x test.sh`
- è„šæœ¬å¯ä»¥æ‰“å¼€æ‘„åƒå¤´æ˜¾ç¤º
- ä¸éœ€è¦æ¥æ”¶é¢œè‰²å‚æ•°ï¼ˆå·²å›ºå®šåœ¨è„šæœ¬ä¸­ï¼‰
- è„šæœ¬è·¯å¾„ï¼š`/home/HwHiAiUser/test.sh`

---

## ğŸ’¬ ä½¿ç”¨ç¤ºä¾‹

### é€šè¿‡ Web UI

```
"æ‰§è¡ŒæŠ“å–"
"å¯åŠ¨æŠ“å–åŠŸèƒ½"
"æŠ“å–ç‰©ä½“"
```

### é€šè¿‡æµ‹è¯•è„šæœ¬

```bash
python test_robot.py

# é€‰æ‹© "3. æ‰€æœ‰æ¨¡å—"
# é€‰æ‹© "3. è‡ªå®šä¹‰ä»»åŠ¡"
# è¾“å…¥ï¼š"æ‰§è¡ŒæŠ“å–"
```

### å¤åˆä»»åŠ¡ç¤ºä¾‹

```
"ç§»åŠ¨åˆ°ç¯®å­ä½ç½®ï¼Œç„¶åæ‰§è¡ŒæŠ“å–"
"æœºæ¢°è‡‚å¤ä½ï¼Œæ‰§è¡ŒæŠ“å–ï¼Œç„¶åå›åˆ°å…¥å£"
"å¯¼èˆªåˆ°å¨æˆ¿æ¡Œå­ï¼Œæ‰§è¡ŒæŠ“å–"
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: è¿æ¥è¢«æ‹’ç»

**é—®é¢˜ï¼š** Connection refused

**è§£å†³ï¼š**
1. ç¡®è®¤å¼€å‘æ¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼š`ps aux | grep grasp_server`
2. æ£€æŸ¥ç«¯å£ï¼š`netstat -tlnp | grep 9999`
3. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼š`ping 192.168.0.155`

### Q2: æœåŠ¡å™¨å¯åŠ¨å¤±è´¥

**é—®é¢˜ï¼š** Address already in use

**è§£å†³ï¼š**
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo lsof -i :9999

# æ€æ­»è¿›ç¨‹
kill <PID>

# æˆ–ä¿®æ”¹æœåŠ¡å™¨ç¨‹åºä½¿ç”¨å…¶ä»–ç«¯å£
```

### Q3: è„šæœ¬ä¸å­˜åœ¨

**é—®é¢˜ï¼š** FAILED:03:æŠ“å–è„šæœ¬ä¸å­˜åœ¨

**è§£å†³ï¼š**
1. ç¡®è®¤è„šæœ¬è·¯å¾„ï¼š`ls -l /home/HwHiAiUser/test.sh`
2. æ·»åŠ æ‰§è¡Œæƒé™ï¼š`chmod +x /home/HwHiAiUser/test.sh`
3. ä¿®æ”¹ `grasp_server.py` ä¸­çš„ `SCRIPT_PATH`

### Q4: æŠ“å–è¶…æ—¶

**é—®é¢˜ï¼š** æŠ“å–è¶…æ—¶ï¼ˆ30ç§’ï¼‰

**è§£å†³ï¼š**
1. ä¿®æ”¹ `grasp_server.py` ä¸­çš„è¶…æ—¶æ—¶é—´ï¼ˆç¬¬47è¡Œï¼‰
2. ä¼˜åŒ–æŠ“å–è„šæœ¬é€Ÿåº¦
3. æ£€æŸ¥æ˜¯å¦æœ‰å¼¹çª—æˆ–äº¤äº’å¼è¾“å…¥

### Q5: æ”¶åˆ°ç©ºæ•°æ®

**é—®é¢˜ï¼š** æœåŠ¡å™¨æ”¶åˆ°ç©ºæ•°æ®

**è§£å†³ï¼š**
1. é‡å¯ slaver åŠ è½½æ–°çš„ grasp æ¨¡å—
2. æ£€æŸ¥ RoboOS é…ç½®ï¼š`BOARD_CONFIG["socket_host"]`
3. ç¡®è®¤å‘é€çš„æ˜¯å•å­—èŠ‚ `0xAA`

---

## ğŸ“Š æ—¥å¿—æŸ¥çœ‹

### å¼€å‘æ¿ç«¯

```bash
# å‰å°è¿è¡Œæ—¶ç›´æ¥åœ¨ç»ˆç«¯æŸ¥çœ‹
python3 grasp_server.py

# åå°è¿è¡Œæ—¶æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f grasp_server.log

# ä½¿ç”¨ systemd æ—¶
sudo journalctl -u grasp-server -f
```

### RoboOS ç«¯

```bash
# æŸ¥çœ‹ slaver æ—¥å¿—
tail -f slaver/.log/agent.log | grep grasp

# æœç´¢æŠ“å–ç›¸å…³æ—¥å¿—
grep "grasp" slaver/.log/agent.log
```

**æ­£å¸¸æ—¥å¿—ç¤ºä¾‹ï¼š**
```
[grasp.grasp_object] å¼€å§‹æ‰§è¡ŒæŠ“å–
[grasp._send_via_socket] è¿æ¥åˆ°å¼€å‘æ¿: 192.168.0.155:9999
[grasp._send_via_socket] è¿æ¥æˆåŠŸ
[grasp._send_via_socket] å‘é€æŒ‡ä»¤: 0xAA
[grasp._send_via_socket] æ”¶åˆ°å“åº”: SUCCESS:00:æŠ“å–æ‰§è¡ŒæˆåŠŸ
```

---

## ğŸ¯ å®Œæ•´å·¥ä½œæµç¨‹

1. **å‡†å¤‡å¼€å‘æ¿**
   - å®‰è£…æŠ“å–æ¨¡å‹å’Œè„šæœ¬åˆ° `/home/HwHiAiUser/test.sh`
   - ç¡®ä¿æ‘„åƒå¤´å¯ç”¨
   - æ·»åŠ æ‰§è¡Œæƒé™ï¼š`chmod +x test.sh`

2. **å¯åŠ¨æœåŠ¡å™¨**
   ```bash
   ssh HwHiAiUser@192.168.0.155
   cd ~
   python3 grasp_server.py
   ```

3. **å¯åŠ¨ RoboOS**
   ```bash
   # é‡å¯ master å’Œ slaver
   python master/run.py
   python slaver/run.py
   ```

4. **å‘é€æŠ“å–ä»»åŠ¡**
   ```
   "æ‰§è¡ŒæŠ“å–"
   ```

5. **è§‚å¯Ÿæ‰§è¡Œ**
   - å¼€å‘æ¿ä¸Šæ˜¾ç¤ºæ‘„åƒå¤´ç”»é¢
   - æ‰§è¡ŒæŠ“å–åŠ¨ä½œ
   - è¿”å›ç»“æœåˆ° RoboOS

---

## ğŸ”„ é…ç½®æ›´æ–°

### RoboOS ç«¯é…ç½®

`slaver/demo_robot_local/grasp.py`:
```python
BOARD_CONFIG = {
    "connection_type": "socket",       # ä½¿ç”¨ Socket
    "socket_host": "192.168.0.155",  # å¼€å‘æ¿IP
    "socket_port": 9999,              # ç«¯å£
    "socket_timeout": 5,               # è¶…æ—¶æ—¶é—´
}
```

### å¼€å‘æ¿ç«¯é…ç½®

`grasp_server.py`:
```python
HOST = '0.0.0.0'                          # ç›‘å¬æ‰€æœ‰æ¥å£
PORT = 9999                              # ç«¯å£
SCRIPT_PATH = '/home/HwHiAiUser/test.sh'  # è„šæœ¬è·¯å¾„
GRASP_COMMAND = 0xAA                      # æŠ“å–æŒ‡ä»¤
```

---

## ğŸ“– ä»£ç ä¿®æ”¹è¯´æ˜

### æ—§åè®®ï¼ˆå·²åºŸå¼ƒï¼‰

```
å‘é€: "GRASP:çº¢è‰²\n"  â† æ–‡æœ¬åè®®
éœ€è¦: é¢œè‰²å‚æ•°
è§£æ: å¤æ‚
```

### æ–°åè®®ï¼ˆå½“å‰ï¼‰

```
å‘é€: 0xAA           â† å­—èŠ‚åè®®
éœ€è¦: æ— å‚æ•°
è§£æ: è¶…ç®€å•
```

---

## ğŸ‰ ä¼˜åŠ¿

âœ… **åè®®ç®€å•** - å•å­—èŠ‚ 0xAA
âœ… **ä¸éœ€è¦å‚æ•°** - ç»Ÿä¸€å¤„ç†
âœ… **æ˜“äºè°ƒè¯•** - åå…­è¿›åˆ¶æ¸…æ™°
âœ… **å¿«é€Ÿå“åº”** - æ•°æ®é‡å°
âœ… **æ˜¾ç¤ºæ­£å¸¸** - æ‘„åƒå¤´ç”»é¢åœ¨å¼€å‘æ¿ä¸Š
âœ… **æ— éœ€è®¤è¯** - Socketç›´è¿
âœ… **æŒç»­ç›‘å¬** - æœåŠ¡å™¨ä¸€ç›´è¿è¡Œ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [MODULE_DEVELOPMENT_GUIDE.md](MODULE_DEVELOPMENT_GUIDE.md) - å®Œæ•´å¼€å‘æŒ‡å—
- [README.md](README.md) - å¿«é€Ÿå¼€å§‹

---

ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼ğŸš€
